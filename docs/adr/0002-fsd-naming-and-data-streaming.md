# ADR-0002: FSD 기반 아키텍처 고도화 및 데이터 흐름 최적화 전략

## 📣 상태

채택됨 (Accepted) - 2026-01-16 [cite: 2026-01-16]

## 📋 상황

만나교회 통합 플랫폼 구축 프로젝트는 요구사항의 변동성이 매우 높은 환경임. [cite: 2026-01-10] 특히 결정권자의 빈번한 기획 변경(기능 추가, UI 수정 등)에 유연하게 대응해야 하며, 1인 개발자로서 유지보수 효율성을 극대화하여 "언제든 쉽고 빠르게 고칠 수 있는 구조"를 만드는 것이 최우선 엔지니어링 과제임. [cite: 2025-12-29, 2026-01-03]

### 해결해야 할 페인 포인트

1. **잦은 요구사항 변경:** 고용주의 의사결정에 따라 기존 기능을 수정하거나 확장해야 하는 상황이 빈번함.
2. **비대해지는 UI 컴포넌트:** 한 파일 내에 데이터 패칭, 폼 검증, UI 렌더링이 뒤섞여 있어 작은 수정에도 전체 로직을 분석해야 하는 번거로움 발생.
3. **데이터 패칭 병목:** 서버 컴포넌트 상단에서의 `await` 호출로 인해 페이지 전환이 느려지는 UX 결함. [cite: 2026-01-16]

## 🔨 결정 (Decisions)

### 1. 명명 규칙 및 폴더 구조의 일관성 (Maintenance-First Naming)

- **단수형 슬라이스 명칭:** 최상위 레이어(`features`, `entities`)는 복수형이나, 내부 슬라이스는 `sermon`, `notice` 등 **단수형**으로 통일하여 도메인 중심의 직관적인 임포트 경로 확보. [cite: 2026-01-16]
- **역할 기반 파일 명명:** `utils.ts`와 같은 모호한 이름을 배제함. 대신 `form-defaults.ts`(초기값), `mapper.ts`(데이터 변환) 등 파일의 역할이 이름에서 즉시 드러나게 하여 수정 시 탐색 시간을 단축함. [cite: 2026-01-16]
- **기능 응집도(Co-location) 강화:** 특정 기능에 종속된 로직은 해당 폴더 내부에 위치시켜, 기획 변경 시 영향 범위를 해당 폴더로 격리함. [cite: 2026-01-16]

### 2. 컴포넌트 책임 분리 및 데이터 매핑 (Decoupled Structure)

- **물리적 역할 분리:** 하나의 기능을 UI(`Form.tsx`), 서버 액션(`actions.ts`), 유효성 검사(`schema.ts`), 상태 관리(`use-form.ts`)로 엄격히 분리함. [cite: 2026-01-16]
- **전용 매퍼(Mapper) 도입:** 서버 데이터(Entity)를 폼 데이터로 변환하는 로직을 독립시킴. [cite: 2026-01-16] 이를 통해 "입력 항목을 추가해달라"거나 "데이터 형식을 바꿔달라"는 요구에 UI 전체를 뜯어고치지 않고 매퍼와 스키마만 수정하여 대응함. [cite: 2026-01-16]

### 3. Non-blocking 데이터 스트리밍 (UX & Performance)

- **Leaf-node Fetching:** 데이터 패칭(`await`) 위치를 페이지 상단이 아닌, 실제 데이터를 사용하는 **최하단 자식 컴포넌트** 레벨로 이동함. [cite: 2026-01-16]
- **Suspense & Skeleton 활용:** 데이터가 로딩되는 동안 부모 페이지와 기본 레이아웃은 즉시 렌더링하고, 로딩 영역은 `Skeleton UI`로 대체함. [cite: 2026-01-16] 이는 네트워크가 불안정한 환경에서도 사용자에게 시스템이 정상 작동 중임을 알리는 핵심 UX 전략임. [cite: 2026-01-10, 2026-01-16]

## 📊 영향 (Consequences)

### 📈 긍정적 영향

- **변경에 강한 구조:** 기획이 바뀌어도 수정해야 할 파일(액션, 스키마, 매퍼 등)이 명확히 정의되어 있어 작업 속도와 정확도가 대폭 향상됨. [cite: 2026-01-16]
- **코드 가독성:** 6개월 뒤에 코드를 다시 봐도 각 파일의 역할이 명확하여 로직 파악에 드는 뇌 리소스 절약. [cite: 2026-01-16]
- **체감 속도 개선:** 스트리밍 방식을 통해 "흰 화면" 없는 즉각적인 페이지 전환 경험 제공. [cite: 2026-01-16]

### 📉 부정적 영향 및 대응

- **초기 생성 파일 수 증가:** 기능 하나당 관리할 파일이 많아지나, FSD의 계층 구조 내에서 체계적으로 관리되므로 전체적인 복잡도는 오히려 감소함.

## 📝 대안 (Alternatives)

### 1. Page-level Fetching (Prop Drilling)

- **기각 사유:** 데이터 로딩이 완료될 때까지 페이지 전체가 멈춰있게 되어, 요구사항 변경 시 부모와 자식 간의 Props 타입을 매번 같이 수정해야 하는 비효율 발생. [cite: 2026-01-16]

### 2. General Utils Folder

- **기각 사유:** 프로젝트 규모가 커질수록 `utils` 폴더가 쓰레기통이 되어, 나중에 특정 로직을 수정할 때 어디에 무엇이 있는지 찾기 불가능해짐. [cite: 2026-01-16]
